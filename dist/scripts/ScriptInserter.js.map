{"version":3,"file":"ScriptInserter.js","names":["getAuthenticatedUser","ScriptInserter","_ref","config","_classCallCheck","scripts","EXTERNAL_SCRIPTS","_createClass","key","value","loadScript","_this","length","isAuthenticated","forEach","script","_script$body","_script$body2","areAuthnRequirementsFulfilled","isAuthnRequired","head","insertToHead","body","top","insertToBodyTop","bottom","insertToBodyBottom","content","createAndAppendScript","document","parent","atStart","arguments","undefined","tempDiv","createElement","innerHTML","scriptElement","querySelector","src","newScriptElement","async","firstChild","insertBefore","appendChild","text"],"sources":["../../src/scripts/ScriptInserter.js"],"sourcesContent":["import { getAuthenticatedUser } from '../auth';\n\n/**\n * Class representing a Script Inserter.\n */\nclass ScriptInserter {\n  /**\n   * Create a Script Inserter.\n   * @param {Array<Object>} scripts - An array of script objects to insert.\n   * @param {string} [scripts[].head] - The script to insert into the head section.\n   * @param {string} [scripts[].body.top] - The script to insert at the top of the body section.\n   * @param {string} [scripts[].body.bottom] - The script to insert at the bottom of the body section.\n   */\n  constructor({ config }) {\n    this.scripts = config.EXTERNAL_SCRIPTS || [];\n  }\n\n  /**\n   * Inserts the scripts into their respective locations (head, body start, body end).\n   */\n  loadScript() {\n    if (!this.scripts.length) {\n      return;\n    }\n\n    const isAuthenticated = !!getAuthenticatedUser();\n\n    this.scripts.forEach((script) => {\n      const areAuthnRequirementsFulfilled = !script.isAuthnRequired || isAuthenticated;\n\n      if (!areAuthnRequirementsFulfilled) {\n        return;\n      }\n\n      if (script.head) {\n        this.insertToHead(script.head);\n      }\n      if (script.body?.top) {\n        this.insertToBodyTop(script.body.top);\n      }\n      if (script.body?.bottom) {\n        this.insertToBodyBottom(script.body.bottom);\n      }\n    });\n  }\n\n  /**\n   * Inserts content into the head section.\n   * @param {string} content - The content to insert into the head section.\n   */\n  insertToHead(content) {\n    this.createAndAppendScript(content, document.head);\n  }\n\n  /**\n   * Inserts content at the start of the body section.\n   * @param {string} content - The content to insert at the top of the body section.\n   */\n  insertToBodyTop(content) {\n    this.createAndAppendScript(content, document.body, true);\n  }\n\n  /**\n   * Inserts content at the end of the body section.\n   * @param {string} content - The content to insert at the bottom of the body section.\n   */\n  insertToBodyBottom(content) {\n    this.createAndAppendScript(content, document.body);\n  }\n\n  /**\n   * Creates a script element and appends it to the specified location.\n   * @param {string} content - The content of the script.\n   * @param {Element} parent - The parent element to insert the script into (head or body).\n   * @param {boolean} atStart - Whether to insert the script at the start of the parent element.\n   */\n  createAndAppendScript(content, parent, atStart = false) {\n    const tempDiv = document.createElement('div');\n    tempDiv.innerHTML = content;\n    const scriptElement = tempDiv.querySelector('script');\n\n    if (scriptElement && scriptElement.src) {\n      // If the script has a src attribute, create a new script element with the same src\n      const newScriptElement = document.createElement('script');\n      newScriptElement.src = scriptElement.src;\n      newScriptElement.async = true;\n\n      if (atStart && parent.firstChild) {\n        parent.insertBefore(newScriptElement, parent.firstChild);\n      } else {\n        parent.appendChild(newScriptElement);\n      }\n    } else {\n      // If the script does not have a src attribute, insert its inner content as inline script\n      const newScriptElement = document.createElement('script');\n      newScriptElement.text = scriptElement ? scriptElement.innerHTML : content;\n\n      if (atStart && parent.firstChild) {\n        parent.insertBefore(newScriptElement, parent.firstChild);\n      } else {\n        parent.appendChild(newScriptElement);\n      }\n    }\n  }\n}\n\nexport default ScriptInserter;\n"],"mappings":"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","ignoreList":[]}